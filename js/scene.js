import*as r from"./_snowpack/pkg/three.js";import*as h from"./_snowpack/pkg/three/addons.js";import{SolarSystem as w}from"./solarSystem.js";import{ExoplanetSystem as f}from"./exoplanetSystem.js";let g=!1,m,a,i,p;export async function initScene(e){if(g)return;g=!0;const o=document.querySelector(e),l=new r.WebGLRenderer({antialias:!0,canvas:o,alpha:!0});l.setPixelRatio(window.devicePixelRatio);{m=new r.Scene;const t=await new r.TextureLoader().loadAsync("images/image_background_stars.jpg");t.mapping=r.EquirectangularReflectionMapping,t.colorSpace=r.SRGBColorSpace,m.background=t}{const t=new r.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e4);m.add(t);const d=new h.OrbitControls(t,o);d.target.set(0,0,0),d.dampingFactor=.2,d.enableDamping=!0,a=new S(t,d)}{const t=new r.AmbientLight("#ffffff",.1);m.add(t)}const n=new P;i=new w,await i.initAsync(),n.positionGroup(i),m.add(i),p=new f,await p.initAsync(),n.positionGroup(p),m.add(p);const s=i.Earth.getWorldPosition(new r.Vector3),c=i.Earth.geometry.parameters.radius;a.Camera.position.set(s.x-c*2,s.y,s.z),a.Controls.target.copy(s),y(l)}let u=!0;export function changeSystem(){const e=u?p.Planet.getWorldPosition(new r.Vector3):i.Earth.getWorldPosition(new r.Vector3),o=u?p.Planet.geometry.parameters.radius:i.Earth.geometry.parameters.radius;a.Camera.position.set(e.x-o*2,e.y,e.z),a.Controls.target.copy(e),u=!u}function y(e){requestAnimationFrame(o);function o(n){const s=n*.001;if(l()){const c=e.domElement;a.Camera.aspect=c.clientWidth/c.clientHeight,a.Camera.updateProjectionMatrix()}i.animate(n),a.Controls.update(),e.render(m,a.Camera),requestAnimationFrame(o)}function l(){const n=e.domElement,s=n.clientWidth,c=n.clientHeight,t=n.width!==s||n.height!==c;return t&&e.setSize(s,c,!1),t}}class S{constructor(o,l){this.Camera=o,this.Controls=l}}class P{constructor(){this.sceneGroupXPosition=0,this.sceneGroupXPositionIncrementor=1e3}positionGroup(o){o.position.set(this.sceneGroupXPosition++*this.sceneGroupXPositionIncrementor,0,0)}}
