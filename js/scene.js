import*as c from"./_snowpack/pkg/three.js";import*as u from"./_snowpack/pkg/three/addons.js";import{SolarSystem as g}from"./solarSystem.js";import{ExoplanetSystem as f}from"./exoplanetSystem.js";let d=!1,p,a,s,l;export async function initScene(o,t=!1){if(d)return;d=!0;const n=document.querySelector(o),r=new c.WebGLRenderer({antialias:!0,canvas:n,alpha:!0});r.setPixelRatio(window.devicePixelRatio);{p=new c.Scene;const e=await new c.TextureLoader().loadAsync("images/image_background_stars.jpg");e.mapping=c.EquirectangularReflectionMapping,e.colorSpace=c.SRGBColorSpace,p.background=e}{const e=new c.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e3);p.add(e);const i=new u.OrbitControls(e,n);i.target.set(0,0,0),i.dampingFactor=.2,i.enableDamping=!0,a=new w(e,i)}{const e=new c.AmbientLight("#ffffff",.1);p.add(e)}const m=new y;if(s=new g,await s.initAsync(),m.positionGroup(s),p.add(s),l=new f,await l.initAsync(),m.positionGroup(l),p.add(l),t){const e=s.Earth.getWorldPosition(new c.Vector3),i=s.Earth.geometry.parameters.radius;a.Camera.position.set(e.x-i*2,e.y,e.z),a.Controls.target.copy(e)}else{const e=s.Earth.getWorldPosition(new c.Vector3),i=s.Earth.geometry.parameters.radius;a.Camera.position.set(e.x-i*2,e.y,e.z),a.Controls.target.copy(e)}h(r)}export async function showExoplanetSystemAsync(o,t){await l.prepareAsync(o);const n=(t?l.Star:l.Planet).getWorldPosition(new c.Vector3),r=t?l.StarRadius:l.PlanetRadius;a.Camera.position.set(n.x-r*2,n.y,n.z),a.Controls.target.copy(n)}export function showSolarSystemAsync(o){const t=(o?s.Sun:s.Earth).getWorldPosition(new c.Vector3),n=(o?s.Sun:s.Earth).geometry.parameters.radius;a.Camera.position.set(t.x-n*2,t.y,t.z),a.Controls.target.copy(t)}function h(o){requestAnimationFrame(t);function t(r){const m=r*.001;if(n()){const e=o.domElement;a.Camera.aspect=e.clientWidth/e.clientHeight,a.Camera.updateProjectionMatrix()}s.animate(r),l.animate(r),a.Controls.update(),o.render(p,a.Camera),requestAnimationFrame(t)}function n(){const r=o.domElement,m=r.clientWidth,e=r.clientHeight,i=r.width!==m||r.height!==e;return i&&o.setSize(m,e,!1),i}}class w{constructor(t,n){this.Camera=t,this.Controls=n}}class y{constructor(){this.sceneGroupXPosition=0,this.sceneGroupXPositionIncrementor=1e4}positionGroup(t){t.position.set(this.sceneGroupXPosition++*this.sceneGroupXPositionIncrementor,0,0)}}
