import*as i from"./_snowpack/pkg/three.js";import*as y from"./_snowpack/pkg/three/addons.js";import{SolarSystem as S}from"./solarSystem.js";import{ExoplanetSystem as P}from"./exoplanetSystem.js";import{SceneCamera as x}from"./sceneCamera.js";const w=-160;let g=!1,d,o,f={x:.5,y:.5},c,m,l;export async function initScene(t,a=null,r=!1){if(g)return!1;globalThis.isDebug=r,g=!0;const s=document.querySelector(t),u=new i.WebGLRenderer({antialias:!0,canvas:s,alpha:!0});u.setPixelRatio(window.devicePixelRatio);{d=new i.Scene;const n=await new i.TextureLoader().loadAsync("images/image_background_stars.jpg");n.mapping=i.EquirectangularReflectionMapping,n.colorSpace=i.SRGBColorSpace,d.background=n}{const n=new i.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e3);d.add(n);const p=new y.OrbitControls(n,s);p.target.set(0,0,0),p.dampingFactor=.2,p.enableDamping=!0,o=new x(n,p)}{const n=new i.AmbientLight("#ffffff",.1);d.add(n)}const e=new I;return m=new S,await m.initAsync(),e.positionGroup(m),d.add(m),l=new P,await l.initAsync(),e.positionGroup(l),d.add(l),a!=null?(await showHomeStateAsync(a),setIsFocusActivePlanetOnScene(!1)):(await showObservatoriesStateAsync(!1),setIsFocusActivePlanetOnScene(!0)),window.addEventListener("mousemove",v,!1),z(u),!0}export async function showHomeStateAsync(t,a=!0){await C(t),o.IsDirectOnPlanet=!1,setIsFocusActivePlanetOnScene(!1,a)}export async function showObservatoriesStateAsync(t,a=!0){A(),o.IsDirectOnPlanet=!0,setIsFocusActivePlanetOnScene(!0,a)}export function setIsFocusActivePlanetOnScene(t,a=!0){o.IsFocusOnScene=t;const r=M(o.IsDirectOnPlanet);o.changeCameraSettings(r.position,r.lookAt,a)}async function C(t){m.hide(),l.show(),await l.prepareAsync(t),c=l}function A(){l.hide(),m.show(),c=m}function z(t){requestAnimationFrame(a);function a(s){const u=s*.001;if(r()){const e=t.domElement;o.Camera.aspect=e.clientWidth/e.clientHeight,o.Camera.updateProjectionMatrix()}if(m.animate(s),l.animate(s),!o.CameraAnimator?.update(s)){if(!o.IsFocusOnScene){const e=o.Controls.target,n=new i.Vector3(e.x+(.5-f.x)/100,e.y+(.5-f.y)/100,e.z+(.5-f.x)/100);Math.abs(o.FocusedCameraTarget.x-n.x)<=c.getPlanetRadius()/10&&(e.x=n.x),Math.abs(o.FocusedCameraTarget.y-n.y)<=c.getPlanetRadius()/10&&(e.y=n.y),Math.abs(o.FocusedCameraTarget.z-n.z)<=c.getPlanetRadius()/10&&(e.z=n.z),o.Controls.target.copy(e)}o.Controls.update()}t.render(d,o.Camera),requestAnimationFrame(a)}function r(){const s=t.domElement,u=s.clientWidth,e=s.clientHeight,n=s.width!==u||s.height!==e;return n&&t.setSize(u,e,!1),n}}function M(t){const a=c.Planet.getWorldPosition(new i.Vector3),r=c.getPlanetRadius();let s=2*r*(t?-1:Math.sin(w*Math.PI/180)),u=t?0:2*r*Math.cos(w*Math.PI/180),e={x:0,z:0};if(!t&&!o.IsFocusOnScene){const h=90-(180-Math.abs(w));e.x=c.getPlanetRadius()*Math.sin(h*Math.PI/180),e.z=c.getPlanetRadius()*Math.cos(h*Math.PI/180)}var n=new i.Vector3(a.x+s-e.x,a.y,a.z+u+e.z),p=new i.Vector3(a.x-e.x,a.y,a.z+e.z);return{position:n,lookAt:p}}function v(t){f.x=t.clientX/window.innerWidth,f.y=t.clientY/window.innerHeight}class I{constructor(){this.sceneGroupXPosition=0,this.sceneGroupXPositionIncrementor=1e4}positionGroup(a){a.position.set(this.sceneGroupXPosition++*this.sceneGroupXPositionIncrementor,0,0)}}class F{}
